# 如何正确地显示随机消息？

```sql
select * from t order by rand() limit 3;
```

order by rand() 内部执行是比较暴力的。需要把所有相关行数据取出来分别计算分配一个随机值（0~1），与主键 id 组成一个临时表，这个临时表优先使用内存，如果内存不足（`tmp_table_size`），则使用磁盘临时表。

ordery by rand() 和 limit n 较小的值配合使用时，会使用 `优先队列排序算法` 。即在内存里只分配 n 个对象空间，依次扫描比较淘汰替换满足条件的值，有点像贪心算法。说到这里，我之前面试入职支付宝就是这道算法题，记忆深刻啊。

其实在业务架构中，如果表的数据比较多，一般会避免这种写法，会改写 sql 写法，或者在业务层引入其它技术方案，比如 Redis 之类。
