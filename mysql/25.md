# MySQL是怎么保证高可用的？

今天讲解的高可用架构是基于双 M 架构的。
虽然是 M 节点，但是同一时刻是只能一个节点能写入数据的，如果多写是可能导致数据不一致，而 binlog\_format 为非 row 时问题会更严重。这个很好理解，因为这就像多线程并发操作不加锁一样。

在做主备切换时，其实要关注两个指标：

1. 数据是否会不一致？可靠性。
2. 业务影响时间多久？可用性。

可靠性：不要出现双写，所以可以 `show slave status` 等 `seconds_behind_master` 的值为 0 时才能做主备写入切换。

可用性：就是缩短切换时间。这个依赖：binlog 网络传输是否延迟；relay log 回放执行是否延迟。
而现在网络延迟一般问题不大，所以可能原因是：

1. 备库机器性能差。
1. 大事务，本身执行就需要花费很久时间。
